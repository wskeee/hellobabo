!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o,r,a=l(e);if(t){var s=l(this).constructor;n=Reflect.construct(a,arguments,s)}else n=a.apply(this,arguments);return o=this,!(r=n)||"object"!==i(r)&&"function"!=typeof r?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(o):r}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.r(t);var u,h=function(){s(t,createjs.EventDispatcher);var e=c(t);function t(){var n;return o(this,t),(n=e.call(this)).comps={},n.libs={},n.loaders={},n.queues=[],n.configs=[],n.loaded={},n._curConfig=null,n._loading=!1,n}return a(t,[{key:"_addQueue",value:function(e){this.queues.push(e),this._nextQueue()}},{key:"_nextQueue",value:function(){0<this.queues.length?this._loading||(this._loading=!0,this._load(this.queues.shift())):this.dispatchEvent("complete")}},{key:"_load",value:function(e){var t=this;this._curConfig=e;var n=new p;n.addEventListener("progress",(function(e){return t._handleProgress(e)})),n.addEventListener("complete",(function(e){return t._handleComplete(e)})),n.load(e),console&&console.log("加载: ",e),this.loaders[e.id]=n}},{key:"_handleProgress",value:function(e){var t=this.configs.length,n=t-this.queues.length-1,i=1/t,o=n*i;this.dispatchEvent(new d(n,t,o+e.progress*i,{progress:e.progress,resId:this._curConfig.id}))}},{key:"_handleComplete",value:function(){this._loading=!1,this.loaded[this._curConfig.id]=!0,this.dispatchEvent(new f(this._curConfig)),this._nextQueue()}},{key:"load",value:function(e){var t=this;this.configs=this.configs.concat(e),e.forEach((function(e){var n=AdobeAn.getComposition(e.id),i=n.getLibrary();t.loaded[e.id]=!1,t.comps[e.id]=n,t.libs[e.id]=i,t._addQueue(e)})),this._nextQueue()}},{key:"getLibRes",value:function(e,t){var n=this.getLib(t);return n[e]?new n[e]:null}},{key:"getComp",value:function(e){return this.comps[e]}},{key:"getLib",value:function(e){return this.libs[e]}},{key:"getLoader",value:function(e){return this.loaders[e]}},{key:"getLibHasDone",value:function(e){return this.loaded[e]}}],[{key:"r",get:function(){return t._r||(t._r=new t),t._r}}]),t}();"_r"in(u=h)?Object.defineProperty(u,"_r",{value:null,enumerable:!0,configurable:!0,writable:!0}):u._r=null;var d=function(){s(t,createjs.Event);var e=c(t);function t(n,i,r,a){var s;return o(this,t),(s=e.call(this,"progress")).load=n,s.total=i,s.progress=r,s.data=a,s}return t}(),f=function(){s(t,createjs.Event);var e=c(t);function t(n){var i;return o(this,t),(i=e.call(this,"resload")).resId=n.id,i.config=n,i}return t}(),p=function(){s(t,createjs.EventDispatcher);var e=c(t);function t(){var n;return o(this,t),n=e.call(this),createjs.Sound.alternateExtensions=["mp3"],n}return a(t,[{key:"_load",value:function(e){var t=this,n=e.id,i=e.path;this.comp=AdobeAn.getComposition(n);var o=this.comp.getLibrary(),r=new createjs.LoadQueue(!0,i);r.installPlugin(createjs.Sound),r.addEventListener("fileload",(function(e){return t._handleFileLoad(e)})),r.addEventListener("progress",(function(e){return t._handleProgress(e)})),r.addEventListener("complete",(function(e){return t._handleComplete(e)})),e.replace&&e.replace.forEach((function(e){o.properties.manifest.forEach((function(t){t.id==e.id&&(t.src=e.url)}))})),r.loadManifest(o.properties.manifest),this.sourceLoader=r}},{key:"_handleFileLoad",value:function(e){var t=this.comp.getImages();e&&"image"==e.item.type&&(t[e.item.id]=e.result),this.dispatchEvent(e.clone())}},{key:"_handleProgress",value:function(e){this.dispatchEvent(e.clone())}},{key:"_handleComplete",value:function(e){for(var t=this.comp,n=t.getLibrary(),i=t.getSpriteSheet(),o=e.target,r=n.ssMetadata,a=0;a<r.length;a++)i[r[a].name]=new createjs.SpriteSheet({images:[o.getResult(r[a].name)],frames:r[a].frames});AdobeAn.compositionLoaded(this.config.id),this.dispatchEvent(e.clone())}},{key:"load",value:function(e){this.comp=null,this.config=e,this._load(e)}}]),t}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i,o,r=w(e);if(t){var a=w(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return i=this,!(o=n)||"object"!==v(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):o}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b,_,x,k=function(){g(t,createjs.EventDispatcher);var e=m(t);function t(){return y(this,t),e.apply(this,arguments)}return t}();_="instance",x=new(b=k),_ in b?Object.defineProperty(b,_,{value:x,enumerable:!0,configurable:!0,writable:!0}):b[_]=x;var E=function(){g(t,createjs.Event);var e=m(t);function t(n,i){var o;return y(this,t),(o=e.call(this,n)).data=i,o}return t}();function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"enabled",value:function(t,n,i,o,r,a){if(null==n&&(n=!0),null==i&&(i=!0),null==o&&(o=!0),null==r&&(r=!1),null==a&&(a=e.disableAlpha),o&&(t.mouseEnabled=n),i){var s=t.filters||[];if(n){var c=s.findIndex((function(t){return t==e.blackAndWhiteFilter}));-1!=c&&(s=s.splice(c,1),t.filters=s)}else s.push(e.blackAndWhiteFilter),t.filters=s}r&&(t.alpha=n?1:a)}},{key:"setEnabled",value:function(t,n,i,o,r,a){e.enabled(t,n,i,o,r,a)}},{key:"setPopBlur",value:function(t,n){var i=t.filters||[];if(null==n&&(n=!0),n)i.push(e.popBlurFilter),t.filters=i;else{var o=i.findIndex((function(t){return t==e.popBlurFilter}));-1!=o&&(i=i.splice(o,1),t.filters=i)}}},{key:"scale",value:function(e,t,n,i,o){var r=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],a=i/t,s=o/n,c=Math.min(a,s);return e.scaleX=e.scaleY=c,r&&(e.x=i-t*c>>1,e.y=o-n*c>>1),c}}],null&&C(t.prototype,null),n&&C(t,n),e}();j(L,"colorMatrix",new createjs.ColorMatrix),j(L,"blackAndWhiteFilter",new createjs.ColorMatrixFilter(L.colorMatrix)),j(L,"popBlurFilter",new createjs.BlurFilter(30,30,4)),j(L,"disableAlpha",.5),L.colorMatrix.adjustSaturation(-100);var O=function(){for(var e=navigator.userAgent,t=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),n=!0,i=0;i<t.length;i++)if(0<e.indexOf(t[i])){n=!1;break}return n};function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function P(e,t,n){return t&&D(e.prototype,t),n&&D(e,n),e}function V(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i,o,r=R(e);if(t){var a=R(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return i=this,!(o=n)||"object"!==T(o)&&"function"!=typeof o?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):o}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(){V(t,createjs.Container);var e=M(t);function t(n,i,o){var r,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:400,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:300;return S(this,t),(r=e.call(this)).id="video_"+Math.round(99999999*Math.random()),r.width=a,r.height=s,r.src=n,r.autoPlay=i,r.video=o,r.videoBuffer=new createjs.VideoBuffer(o),r.videoBM=new createjs.Bitmap(r.videoBuffer),r.videoWidth=r.videoHeight=0,r.initVideoEvent(),r.initControl(),r}return P(t,[{key:"initControl",value:function(){this.control=new A(this,this.width,this.height),this.addChild(this.control)}},{key:"initVideoEvent",value:function(){var e=this;this.video.addEventListener("play",(function(t){e.dispatchEvent(new E("playing"))})),this.video.addEventListener("loadedmetadata",(function(t){e.onVideoEvent(t)}))}},{key:"onVideoEvent",value:function(e){switch(console.log(e),e.type){case"loadedmetadata":this.videoWidth=this.video.videoWidth,this.videoHeight=this.video.videoHeight}}},{key:"seek",value:function(e){this.video.currentTime=e}},{key:"play",value:function(){try{this.video.play()}catch(e){}}},{key:"pause",value:function(){try{this.video.pause()}catch(e){}}},{key:"toggle",value:function(){this.video.paused?this.play():this.pause()}},{key:"destory",value:function(){this.pause(),this.video.remove(),this.control.destory(),this.parent.removeChild(this)}},{key:"isPlaying",get:function(){return!this.video.paused}}],[{key:"getVideo",value:function(e,n,i,o){var r=2<arguments.length&&void 0!==i?i:400,a=3<arguments.length&&void 0!==o?o:300,s=document.getElementsByClassName("video-box")[0];s||((s=document.createElement("div")).className="video-box",document.body.appendChild(s));var c=window.appData?window.appData.path:"";e=-1==e.indexOf("http://")?c+e:e;var l=document.createElement("video");s.append(l),l.src=e,l.autoPlay=n,l.style.display="none",l.setAttribute("webkit-playsinline",!0),l.setAttribute("playsinline",!0),l.setAttribute("x5-video-player-type","h5");var u=new t(e,n,l,r,a);return t.videos.push(u),u}},{key:"destoryAllVideo",value:function(){t.videos.forEach((function(e){return e.destory()})),t.videos=[]}}]),t}();B(H,"videos",[]);var A=function(){V(t,createjs.Container);var e=M(t);function t(n){var i,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:200;return S(this,t),(i=e.call(this)).video=n,i.width=o,i.height=r,i.initChild(),i.initVideoEvent(),i}return P(t,[{key:"initChild",value:function(){var e=this,t=window.lib;this.play_icon=new t.play_icon,this.pause_icon=new t.pause_icon,this.bar=new I(this.width,10),this.content=new createjs.Container,this.addChild(this.content),this.addChild(this.play_icon),this.addChild(this.pause_icon),this.addChild(this.bar),this.content.addChild(this.video.videoBM),this.bar.addEventListener(N.CHANGED,(function(t){var n=t.data.percentage;e.video.seek(e.video.duration*n)})),this.addEventListener("mousedown",(function(t){e.video.toggle()})),this.refresh()}},{key:"initVideoEvent",value:function(){var e=this,t=this.video.video;t.addEventListener("play",(function(t){e.onVideoEvent(t)})),t.addEventListener("pause",(function(t){e.onVideoEvent(t)})),t.addEventListener("timeupdate",(function(t){e.onVideoEvent(t)})),t.addEventListener("loadedmetadata",(function(t){e.onVideoEvent(t)}))}},{key:"onVideoEvent",value:function(e){switch(e.type){case"play":case"pause":this.showControl(),this.refresh();break;case"loadedmetadata":this.refresh();break;case"timeupdate":this.bar.setValue(this.video.currentTime/this.video.duration)}}},{key:"refresh",value:function(){this.video.videoBM&&L.scale(this.video.videoBM,this.video.videoWidth,this.video.videoHeight,this.width,this.height),this.play_icon.visible=!this.video.isPlaying,this.pause_icon.visible=this.video.isPlaying,this.play_icon.x=this.pause_icon.x=this.width>>1,this.play_icon.y=this.pause_icon.y=this.height>>1,this.bar.y=this.height-this.bar.height}},{key:"showControl",value:function(e,t){var n=this,i=!(0<arguments.length&&void 0!==e)||e,o=1<arguments.length&&void 0!==t?t:2e3;clearTimeout(this.hideDelay),this._showControl(!0),i&&(this.hideDelay=setTimeout((function(){n._showControl(!1)}),o))}},{key:"_showControl",value:function(e){console.log("_showControl",e),this.play_icon.visible=this.pause_icon.visible=this.bar.visible=e}},{key:"destory",value:function(){this.bar.removeAllEventListeners(N.CHANGED),this.removeAllEventListeners("mousedown")}}]),t}(),I=function(){V(t,createjs.Container);var e=M(t);function t(){var n,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"#28b28b",a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"#ffffff";return S(this,t),(n=e.call(this)).value=0,n.width=i,n.height=o,n.doneColor=r,n.railColor=a,n.initChild(),n}return P(t,[{key:"initChild",value:function(){var e=this;this.done=new createjs.Shape,this.rail=new createjs.Shape,this.addEventListener("mousedown",(function(t){var n=e.width,i=e.ui.globalToLocal(t.stageX,t.stageY).x/n;t.stopImmediatePropagation(),t.stopPropagation(),e.dispatchEvent(new N(N.CHANGED,{percentage:i}))})),this.setValue(0)}},{key:"setValue",value:function(e){this.value=e,this.draw()}},{key:"draw",value:function(){this.done.graphics.clear(),this.done.graphics.beginFill(this.doneColor),this.done.graphics.drawRect(0,0,this.width*this.value,this.height),this.done.graphics.clear(),this.rail.graphics.beginFill(this.railColor),this.rail.graphics.drawRect(0,0,this.width,this.height)}}]),t}(),N=function(){V(t,createjs.Event);var e=M(t);function t(n,i){var o;return S(this,t),(o=e.call(this,n)).data=i,o}return t}();function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,n){return t&&W(e.prototype,t),n&&W(e,n),e}function Q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function X(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i,o,r=G(e);if(t){var a=G(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return i=this,!(o=n)||"object"!==F(o)&&"function"!=typeof o?q(i):o}}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}B(N,"CHANGED","changed");var Z,U,J=function(){Q(t,createjs.Container);var e=X(t);function t(n,i){var o,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"h";return z(this,t),o=e.call(this),t.instance=q(o),o.appData=window.appData,o.index=0,o.isLock=!1,o.isTween=!1,o.viewList=[],o.contentView=o.addChild(new createjs.Container),o.moveView=o.currentView=null,o.viewH=i,o.viewW=n,o.scrollDir=r,o.pageSize="h"===r?n:i,o.appData.goods.orientation&&"landscape"===o.appData.goods.orientation&&(o.viewH=n,o.viewW=i,o.pageSize=i),o.initChild(),o.initEvent(),o.appData.goods.orientation&&"landscape"===o.appData.goods.orientation&&(o.contentView.rotation=90,o.contentView.x=n,document.getElementsByClassName("page-num-box")[0].className+=" landscape"),o}return Y(t,[{key:"initChild",value:function(){var e,t=this;this.appData.scenes.forEach((function(n){e=new K(n,t.viewW,t.viewH),t.viewList.push(e)})),this.pageNum=document.getElementsByClassName("page-num")[0],this.floatView=document.getElementsByClassName("float-view")[0],this.shareBtn=this.floatView.getElementsByClassName("share-btn")[0],this.buyBtn=this.floatView.getElementsByClassName("buy-btn")[0],this.shareTxt=this.shareBtn.getElementsByClassName("share-txt")[0],this.currentView=this.viewList[0],this.currentView.active=!0,this.addContent(this.currentView),this.checkLock(0),this.pageNum.innerHTML="1 / "+this.viewList.length,this.shareBtn.style.display=this.buyBtn.style.display="none",this.floatView.style.display="flex",this.checkMiniProgram()}},{key:"checkMiniProgram",value:function(){var e=this,t=this.appData;wx.miniProgram.getEnv((function(n){n.miniprogram&&(0!=t.showShare&&(e.shareBtn.style.display="flex"),0!=t.showBuy&&(e.buyBtn.style.display="flex"),e.shareTxt.innerHTML="赚￥"+t.goods.commission)}))}},{key:"initEvent",value:function(){var e=this;this.shareBtn.addEventListener("mousedown",(function(e){var t=1==appData.goods.type?appData.goods.gid:appData.goods.ogid;wx.miniProgram.navigateTo({url:"/pages/goods/share?type=".concat(appData.goods.type,"&id=").concat(t)})}),!0),this.buyBtn.addEventListener("mousedown",(function(e){wx.miniProgram.navigateTo({url:"/pages/order/create/create?goods_id=".concat(appData.goods.gid)})}),!0),k.instance.addEventListener("sceneFinished",(function(t){e.setSceneLock(e.index,!1)})),k.instance.addEventListener("nextScene",(function(t){e.next()})),k.instance.addEventListener("prevScene",(function(t){e.prev()})),k.instance.addEventListener("changeScene",(function(t){e.changeIndex(t.data.value),e.showNav(!1)})),k.instance.addEventListener("hideNav",(function(t){e.showNav(!1)}))}},{key:"changeIndex",value:function(e){this.changeView(this.index>e?"next":"prev",e)}},{key:"changeView",value:function(e,t,n){if(!this.isTween&&this.index!=t){var i="h"==this.scrollDir?"x":"y",o=this.pageSize;this.moveView=this.viewList[t],this.addContent(this.moveView),this.moveView[i]=o,this.changeHandler("next",t,n)}}},{key:"changeHandler",value:function(e,t,n){var i=this;if(!(t<0||t>this.viewList.length-1)||1==n){var o=this.moveView,r=this.currentView,a="h"==this.scrollDir?"x":"y",s=this.pageSize,c={},l={};c[a]=0,this.isTween=!0,this.index=t,this.checkLock(t),this.pageNum.innerHTML=t+1+" / "+this.viewList.length,createjs.Sound.stop(),H.destoryAllVideo(),"next"==e?(l[a]=-s,createjs.Tween.get(r).to(l,400,createjs.Ease.sineOut).call((function(){return i.delayComplete()}))):(l[a]=s,createjs.Tween.get(o).to(c,400,createjs.Ease.sineOut).call((function(){return i.delayComplete()})))}}},{key:"delayComplete",value:function(){var e=this.currentView;this.isTween=!1,e.active=!1,e.reset(),this.removeContent(e),(e=this.currentView=this.viewList[this.index]).active=!0,e.play()}},{key:"resumeHandler",value:function(e){var n=this.moveView,i=this.currentView,o="h"==this.scrollDir?"x":"y",r=this.pageSize,a={},s={};a[o]=0,t.bi=Math.abs(i[o]/r),s[o]="next"==e?-r:r,createjs.Tween.get(i).to(a,500*t.bi),createjs.Tween.get(n).to(s,500*t.bi).call(this.resumeComplete)}},{key:"resumeComplete",value:function(){var e=this.moveView;e&&this.removeContent(e)}},{key:"addContent",value:function(e){this.contentView.addChild(e)}},{key:"removeContent",value:function(e){e.parent&&e.parent.removeChild(e)}},{key:"next",value:function(){this.changeView("next",this.index+1)}},{key:"prev",value:function(){this.changeView("prev",this.index-1)}},{key:"lock",value:function(){this.isLock=!0}},{key:"unlock",value:function(){this.isLock=!1}},{key:"setSceneLock",value:function(e,t){this.appData.scenes[e].lock=t,this.checkLock(e)}},{key:"checkLock",value:function(e){var t=this.moveView?this.moveView:this.currentView;this.isLock=this.appData.scenes[e].lock,t.nextTips.visible=!this.isLock&&0==e&&1<this.viewList.length}},{key:"showNav",value:function(e){(this.navView.visible=e)?this.lock():this.checkLock(this.index)}}]),t}();(U="instance")in(Z=J)?Object.defineProperty(Z,U,{value:void 0,enumerable:!0,configurable:!0,writable:!0}):Z[U]=void 0;var K=function(){Q(t,createjs.Container);var e=X(t);function t(n,i,o){var r;return z(this,t),(r=e.call(this)).width=i,r.height=o,r.libConfig=n,r.active=!1,r.init(),r}return Y(t,[{key:"init",value:function(){var e=this,t=this.libConfig;this.borderShadow=h.r.getLibRes("border_shadow",oe.commonResId),this.nextTips=h.r.getLibRes("next_tips",oe.commonResId),this.nextTips.visible=!1;var n=this.loading=h.r.getLibRes("loading",oe.commonResId);this.addChild(n),n.setTransform(this.width/2,this.height/2),h.r.addEventListener("progress",(function(e){e.data.resId==t.id&&(n.txt.text=Math.round(100*e.data.progress)+"%")})),h.r.addEventListener("resload",(function(n){n.resId==t.id?e.initChild():n.config.scene_id==t.id&&e.initMaterial(n.config)}))}},{key:"initChild",value:function(){this.removeChild(this.loading),this.content=h.r.getLibRes("page",this.libConfig.id),this.addChild(this.content),this.addChild(this.nextTips),this.addChild(this.borderShadow),this.nextTips.setTransform(this.width-5,this.height/2),this.borderShadow.setTransform(this.width,0,1,oe.h/this.borderShadow.nominalBounds.height),this.active?this.content.play():this.content.gotoAndStop(0)}},{key:"initMaterial",value:function(e){var t=this,n={m_hero:"hero",m_elfin:"elfin"};Object.keys(n).forEach((function(i){var o=n[i],r=t.content[i];if(null!=r){var a=h.r.getLibRes(o,e.id);a&&(r.removeAllChildren(),r.addChild(a))}}))}},{key:"play",value:function(){this.content&&this.content.play()}},{key:"reset",value:function(){this.content&&(this.content.stop(),this.content.gotoAndStop(0))}},{key:"stop",value:function(){this.content&&this.content.stop()}}]),t}();function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"init",value:function(t,n,i,o){var r=2<arguments.length&&void 0!==i?i:720,a=3<arguments.length&&void 0!==o?o:1280;e.stage=t,e.view=n,e.w=r,e.h=a,O()?e.mouseInit():e.touchInit()}},{key:"mouseInit",value:function(){var t="h"==e.scrollDir?"x":"y",n="h"==e.scrollDir?"X":"Y",i=0,o=0,r=!1,a="h"==e.scrollDir?e.w:e.h,s=e.stage,c=e.view;function l(e){if(!c.isTween&&!c.isLock){var t=c.index,n=0,i=c.viewList,r=i.length,s=c.moveView,l=c.currentView;r<t||(0<e&&0<t?(s=c.moveView=i[t-1],n=-a,s.parent||(s.x=0,c.addContent(s)),s&&(s.x=o+e+n)):e<0&&t<r&&(s=c.moveView=i[t+1],n=a,s&&(s.parent||(s.x=0,c.addContent(s)),l.x=o+e,c.addContent(l))))}}s.addEventListener("stagemousedown",(function(e){c.isTween||c.isLock||(r=!0,i=e["raw".concat(n)],o=c[t])})),s.addEventListener("stagemousemove",(function(e){c.isTween||c.isLock||0!=r&&l(e["raw".concat(n)]-i)})),s.addEventListener("stagemouseup",(function(t){if(!c.isTween&&!c.isLock){var o=c.currentView,a=c.moveView,s=c.index,u=t["raw".concat(n)];i!=u?a&&a.x<0?a.x<-1?c.changeHandler("prev",s-1):c.resumeHandler("next"):o&&o.x<0&&(o.x<-1?c.changeHandler("next",s+1):c.resumeHandler("prev")):u<e.stage.canvas.width/2?0<s&&(l(1),c.changeHandler("prev",s-1)):s<c.viewList.length&&(l(-1),c.changeHandler("next",s+1)),r=!1}}))}},{key:"touchInit",value:function(){var t="h"==e.scrollDir?"x":"y",n="h"==e.scrollDir?"X":"Y",i=0,o=0,r="h"==e.scrollDir?e.w:e.h,a=e.stage,s=e.view;function c(e){if(!s.isTween&&!s.isLock){var t=0,n=s.index,i=s.viewList,a=i.length,c=s.moveView,l=s.currentView;a<n||(0<e&&0<n?(c=s.moveView=i[n-1],t=-r,c.parent||(c.x=0,s.addContent(c)),c&&(c.x=o+e+t)):e<0&&n<a&&(c=s.moveView=i[n+1],t=r,c&&(c.parent||(c.x=0,s.addContent(c)),l.x=o+e,s.addContent(l))))}}a.addEventListener("touchstart",(function(e){if(!s.isTween&&!s.isLock){e.preventDefault();var r=e.targetTouches[0];i=r["page".concat(n)],o=s[t]}}),!1),a.addEventListener("touchmove",(function(e){s.isTween||s.isLock||1!=e.targetTouches.length||(e.preventDefault(),c(e.targetTouches[0]["page".concat(n)]-i))}),!1),a.addEventListener("touchend",(function(t){if(!s.isTween&&!s.isLock){var o=s.index,r=s.currentView,a=s.moveView,l=t.changedTouches[0]["page".concat(n)];i!=l?a&&a.x<0?a.x<-1?s.changeHandler("prev",o-1):s.resumeHandler("next"):r&&r.x<0&&(r.x<-1?s.changeHandler("next",o+1):s.resumeHandler("prev")):l<e.stage.width/2?0<o&&(c(1),s.changeHandler("prev",o-1)):o<s.viewList.length&&(c(-1),s.changeHandler("next",o+1))}}),!1)}}],null&&$(t.prototype,null),n&&$(t,n),e}();function ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ee(te,"w",1080),ee(te,"h",1778),ee(te,"stage",void 0),ee(te,"view",void 0),ee(te,"scrollDir","v"),ee(te,"forbiddenZone",null);var oe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stage,this.canvas,this.anim_container,this.dom_overlay_container,this.stageWidth=0,this.stageHeight=0}var t,n;return t=e,(n=[{key:"init",value:function(e,t,n){var i=this;window.playSound=this.playSound;var o=this.appData=window.appData;this.libs=[o.common].concat(o.scenes),this.canvas=e,this.anim_container=t,this.dom_overlay_container=n,this.loader=h.r,this.loader.load(this.libs),this.loader.addEventListener("progress",(function(e){document.getElementById("preloader-txt").innerText=Math.round(100*e.progress)+"%"})),this.loader.addEventListener("resload",(function(e){if(e.resId==o.common.id){var t=document.getElementsByClassName("preloader-box")[0];t&&(t.style.display="none"),i.initStage(),i.initView()}})),this.loader.addEventListener("complete",(function(e){console&&console.log("所有资源加载完成！")}))}},{key:"initStage",value:function(){var t=this,n=this.exportRoot=new createjs.Container,i=this.stage=new createjs.StageGL(this.canvas);this.resize(),i.addChild(n),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.framerate=e.fps,createjs.Ticker.addEventListener("tick",(function(e){return t.handleTick(e)}))}},{key:"initView",value:function(){var t=this.exportRoot,n=this.appData.goods.orientation,i=n&&"landscape"===n?"v":"h",o=new J(e.w,e.h);t.addChild(o),te.scrollDir=i,te.init(O()?this.stage:this.canvas,o,e.w,e.h)}},{key:"playSound",value:function(e){return createjs.Sound.play(e)}},{key:"handleTick",value:function(){var e=this.stage;this.exportRoot,e.update()}},{key:"getProjectionMatrix",value:function(t,n){var i=e.w/2,o=e.h/2,r=(n+528.25)/528.25,a=new createjs.Matrix2D;a.a=1/r,a.d=1/r;var s=new createjs.Matrix2D;return s.tx=-i,s.ty=-o,(s=s.prependMatrix(a)).tx+=i,s.ty+=o,s}},{key:"analyzeRootDepth",value:function(){var e=this.exportRoot.___camera___instance;void 0!==e&&void 0!==e.pinToObject&&(e.x=e.pinToObject.x+e.pinToObject.pinOffsetX,e.y=e.pinToObject.y+e.pinToObject.pinOffsetY,void 0!==e.pinToObject.parent&&void 0!==e.pinToObject.parent.depth&&(e.depth=e.pinToObject.parent.depth+e.pinToObject.pinOffsetZ)),this.applyLayerZDepth(this.exportRoot)}},{key:"applyLayerZDepth",value:function(t){var n=t.___camera___instance,i={x:0,y:0};if(t===this.exportRoot){var o={x:e.w/2,y:e.h/2};i.x=o.x,i.y=o.y}for(var r in t.children){var a=t.children[r];if(a!=n&&(this.applyLayerZDepth(a,n),void 0!==a.layerDepth)){a.currentFrame!=a.parent.currentFrame&&a.gotoAndPlay(a.parent.currentFrame);var s=new createjs.Matrix2D,c=new createjs.Matrix2D,l=a.layerDepth?a.layerDepth:0,u=0;if(n&&!a.isAttachedToCamera){var h=n.getMatrix();h.tx-=i.x,h.ty-=i.y,(c=h.invert()).prependTransform(i.x,i.y,1,1,0,0,0,0,0),c.appendTransform(-i.x,-i.y,1,1,0,0,0,0,0),n.depth&&(u=n.depth)}if(a.depth&&(l=a.depth),(l-=u)<-528.25)s.a=0,s.d=0;else{if(a.layerDepth){var d=this.getProjectionMatrix(t,a.layerDepth);d&&(d.invert(),s.prependMatrix(d))}s.prependMatrix(c);var f=this.getProjectionMatrix(t,l);f&&s.prependMatrix(f)}a.transformMatrix=s}}}},{key:"makeResponsive",value:function(e,t,n,i){var o=this;window.addEventListener("resize",(function(r){return o.resizeCanvas(e,t,n,i)})),this.resizeCanvas(e,t,n,i)}},{key:"resizeCanvas",value:function(t,n,i,o){var r,a,s=1,c=this.stage,l=this.canvas;function u(){var u=e.w,h=e.h,d=window.innerWidth,f=window.innerHeight,p=window.devicePixelRatio||1,v=d/u,y=f/h,g=1;t&&("width"==n&&r==d||"height"==n&&a==f?g=s:i?1==o?g=Math.min(v,y):2==o&&(g=Math.max(v,y)):(d<u||f<h)&&(g=Math.min(v,y))),l.width=u*p*g,l.height=h*p*g,l.style.width=u*g+"px",l.style.height=h*g+"px",c.scaleX=p*g,c.scaleY=p*g,r=d,a=f,s=g,c.tickOnUpdate=!1,c.updateViewport(l.width,l.height),c.tickOnUpdate=!0}window.addEventListener("resize",u),u()}},{key:"resize",value:function(){var t=1/window.devicePixelRatio,n=this,i=this.canvas,o=this.stage,r=this.exportRoot,a=(document.getElementsByClassName("e-head")[0],17),s=this.stageWidth,c=this.stageHeight;document.querySelector('meta[name="viewport"]').setAttribute("content","width=device-width,initial-scale="+t+", maximum-scale="+t+", minimum-scale="+t+", user-scalable=no"),function(){if(s!=document.documentElement.clientWidth||c!=document.documentElement.clientHeight){s=n.stageWidth=document.documentElement.clientWidth,c=n.stageHeight=document.documentElement.clientHeight;var t=s-2*a,l=t/e.w,u=e.h*l;c-2*a<u&&(u=c-2*a),i.width=t;var h=((i.height=u)-e.h*l)/2;r.scaleX=l,r.scaleY=l,r.y=h,o.updateViewport(t,u)}}()}}])&&ne(t.prototype,n),e}();function re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function se(e,t,n,i,o,r,a,s){ae(this,se),this.pos={x:e||0,y:t||0},this.speed=i||5,this.life=o||1,this.size=r||2,this.lived=0;var c=n*Math.PI/180;this.vel={x:Math.cos(c)*i,y:-Math.sin(c)*i},this.colour=a,this.colour_step=s}ie(oe,"w",1080),ie(oe,"h",1778),ie(oe,"fps",60),ie(oe,"commonResId","E4019F635D6CBC488C42C0A8B05F0249");var ce={coms:{Video:H},utils:{DisplayObjectUitl:L,Emitter:function(){function e(t,n,i){ae(this,e),this.pos={x:t,y:n},this.settings=i,this._render=i.render,this.emission_delay=1e3/i.emission_rate,this.last_update=0,this.last_emission=0,this.particles=[],this.position_vary=this.settings.position_range||!1,this.min_position=this.settings.min_position||{x:0,y:0}}var t,n;return t=e,(n=[{key:"update",value:function(){if(this.last_update){var e=Date.now(),t=e-this.last_update;if(this.last_emission+=t,this.last_update=e,this.last_emission>this.emission_delay){var n=Math.floor(this.last_emission/this.emission_delay);for(this.last_emission-=n*this.emission_delay;n--;){var i=this.settings.start_colours[Math.floor(this.settings.start_colours.length*Math.random())],o=this.settings.end_colours[Math.floor(this.settings.end_colours.length*Math.random())],r=this.settings.min_life+Math.random()*this.settings.life_range,a=[(o[0]-i[0])/r,(o[1]-i[1])/r,(o[2]-i[2])/r,(o[3]-i[3])/r];this.particles.push(new se(this.min_position.x+(this.position_vary?Math.random()*this.position_vary.x:0),this.min_position.y+(this.position_vary?Math.random()*this.position_vary.y:0),this.settings.min_angle+Math.random()*this.settings.angle_range,this.settings.min_speed+Math.random()*this.settings.speed_range,r,this.settings.min_size+Math.random()*this.settings.size_range,i.slice(),a))}}t/=1e3;for(var s=this.particles.length;s--;){var c=this.particles[s];if(c.dead)this.particles.splice(s,1);else if(c.lived+=t,c.lived>=c.life)c.dead=!0;else{c.vel.x+=this.settings.gravity.x*t,c.vel.y+=this.settings.gravity.y*t,c.pos.x+=c.vel.x*t,c.pos.y+=c.vel.y*t,c.colour[0]+=c.colour_step[0]*t,c.colour[1]+=c.colour_step[1]*t,c.colour[2]+=c.colour_step[2]*t,c.colour[3]+=c.colour_step[3]*t,this._render.beginFill("rgba("+Math.round(c.colour[0])+","+Math.round(c.colour[1])+","+Math.round(c.colour[2])+","+c.colour[3]+")");var l=this.pos.x+c.pos.x,u=this.pos.y+c.pos.y;this._render.arc(l,u,c.size,0,2*Math.PI),this._render.endFill()}}}else this.last_update=Date.now()}},{key:"render",value:function(){this._render.clear(),this.update()}}])&&re(t.prototype,n),e}()},manager:{EventManager:k},hellobabo:{init:function(){try{document.createElement("canvas").getContext("2d")}catch(e){return}(new oe).init(document.getElementById("book_canvas"),document.getElementById("animation_container"),document.getElementById("dom_overlay_container"))}}};Object.assign(ce,window.wskeee||{}),window.onload=ce.hellobabo.init,window.wskeee=ce,t.default=ce}]);
//# sourceMappingURL=app.bundle.js.map